{"version":3,"sources":["detail.js"],"names":["createDetail","json","token","detail","data","details","fltStrarr","undefined","buildId","buildingId","length","$","after","obj","find","addClass","html","on","window","location","href","point","locations","localStorage","JSON","stringify","floor","xCoord","yCoord","hide","icon","follow","status","flt","fltInfo","sub","subscribeStatus","fltStr","identification","split","time","timeStr","substring","timeStart","timeEnd","fltiden","console","log","releaseStatus1","actTime","name","value","estTime","destActTime","destEstTime","arrdep","airlineCode","bltDisp","bltOt","arr","iata","cntDisp","gateDisp","firstGatOt","slice","error","startAirportNameCn","destAirportNameCn","iataCn","fltNo","sdtTime","destSdtTime","color","getStateColor","css","background","backgroundSize","appendTo","flyno","cntTerminalNo","djdata","djjson","url","success","removeItem","newstr","i","setItem","ajaxBase","getUrlQueryString","document","ready","fltId","sessionStorage","getItem","this","reload"],"mappings":"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","file":"../detail.js","sourcesContent":["var arrdep = getUrlQueryString('arrdep');\r\n$(document).ready(function () {\r\n\tvar fltId = getUrlQueryString('fltId');\r\n\tvar token = sessionStorage.getItem('token');\r\n\tvar json = {\r\n\t\turl: 'http://airtest.rtmap.com/service-api/flight/getFltDetial?token=' + token,\r\n\t\tdata: {\r\n\t\t\tidentification: fltId\r\n\t\t},\r\n\t\tsuccess: function (data) {\r\n\t\t\t console.log(token);\r\n\t\t\tcreateDetail(data,token);\r\n\t\t}\r\n\t};\r\n\tajaxBase(json);\r\n\t$('.g-wrap').on('click', \".bottom li\", function () {\r\n\t\tif ($(this).html() == \"关注航班\") {\r\n\t\t\tvar json = {\r\n\t\t\t\turl: 'http://airtest.rtmap.com/service-api/subscribe/followFlight?token=' + token,\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tidentification: fltId\r\n\t\t\t\t},\r\n\t\t\t\tsuccess: function (data) {\r\n\t\t\t\t\tlocation.reload();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\tvar json = {\r\n\t\t\t\turl: 'http://airtest.rtmap.com/service-api/subscribe/unfollowFlight?token=' + token,\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tidentification: fltId\r\n\t\t\t\t},\r\n\t\t\t\tsuccess: function (data) {\r\n\t\t\t\t\tlocation.reload();\r\n\t\t\t\t\t// dialogA = Dialog.init('alert');\r\n\t\t\t\t\t// dialogA.show(); // 显示弹窗\r\n\t\t\t\t\t// dialogA.setValue('您确定取消关注吗？');\r\n\t\t\t\t\t// dialogA.off('confirm');\r\n\t\t\t\t\t// dialogA.on('confirm', function () {\r\n\t\t\t\t\t// });\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t};\r\n\t\tajaxBase(json);\r\n\t});\r\n});\r\nfunction createDetail(json,token) {\r\n\tvar flt = json.fltInfo;\r\n\tvar sub = json.subscribeStatus;\r\n\tvar fltStr = flt.identification.split('-');\r\n\tvar time = fltStr[2];\r\n\tvar timeStr = time.substring(0, 4) + '-' + time.substring(4, 6) + '-' + time.substring(6, 8);\r\n\tvar icon, follow, status;\r\n\tvar timeStart = {};\r\n\tvar timeEnd = {};\r\n\tvar fltiden = flt.identification;\r\n\t// TODO判断是否到达\r\n\tvar fltStrarr = fltiden.substring(fltiden.length - 1)\r\n\tconsole.log(flt)\r\n\tif (flt.releaseStatus1) { \r\n\t\tstatus = flt.releaseStatus1;\r\n\t} else {\r\n\t\tstatus = '计划';\r\n\t}\r\n\tif (flt.actTime) {\r\n\t\ttimeStart.name = '实际起飞';\r\n\t\ttimeStart.value = flt.actTime;\r\n\t} else if (flt.estTime) {\r\n\t\ttimeStart.name = '预计起飞';\r\n\t\ttimeStart.value = flt.estTime;\r\n\t} else {\r\n\t\ttimeStart.name = '预计起飞';\r\n\t\ttimeStart.value = '-';\r\n\t}\r\n\tif (flt.destActTime) {\r\n\t\ttimeEnd.name = '实际到达';\r\n\t\ttimeEnd.value = flt.destActTime;\r\n\t} else if (flt.destEstTime) {\r\n\t\ttimeEnd.name = '预计到达';\r\n\t\ttimeEnd.value = flt.destEstTime;\r\n\t} else {\r\n\t\ttimeEnd.name = '预计到达';\r\n\t\ttimeEnd.value = '-';\r\n\t}\r\n\tif (arrdep == 'arr') {\r\n\t\ticon = flt.airlineCode;\r\n\t\tbltDisp = flt.bltDisp || '-';\r\n\t\tbltOt = flt.bltOt || '-';\r\n\t\tvar arr = [{\r\n\t\t\t\tname: '行李转盘',\r\n\t\t\t\tvalue: bltDisp\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tname: '转盘开放时间',\r\n\t\t\t\tvalue: bltOt\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tname: '出租车等待时长',\r\n\t\t\t\tvalue: '-'\r\n\t\t\t}\r\n\t\t];\r\n\t} else if (arrdep == 'dep') {\r\n\t\ticon = flt.iata;\r\n\t\tcntDisp = flt.cntDisp || '-';\r\n\t\tgateDisp = flt.gateDisp || '-';\r\n\t\ttry {\r\n\t\t\tfirstGatOt = flt.firstGatOt.slice(11, flt.firstGatOt.length).slice(0, 5) || '-';\r\n\t\t} catch (error) {\r\n\t\t\tfirstGatOt = '-';\r\n\t\t}\r\n\t\tvar arr = [\r\n\t\t\t// {name:'值机柜台',value:cntDisp},\r\n\t\t\t{\r\n\t\t\t\tname: '登机口开放时间',\r\n\t\t\t\tvalue: firstGatOt\r\n\t\t\t}, \r\n\t\t\t{\r\n\t\t\t\tname: '登机口',\r\n\t\t\t\tvalue: gateDisp\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tname: '安检排队时长',\r\n\t\t\t\tvalue: '-'\r\n\t\t\t}\r\n\t\t];\r\n\t}\r\n\tif (sub == \"Y\") {\r\n\t\tfollow = '取消关注';\r\n\t} else {\r\n\t\tfollow = '关注航班';\r\n\t}\r\n\tconsole.log(status)\r\n\tvar obj = $('<div class=\"top clearfix\">' +\r\n\t\t'<div class=\"left fl\" style=\"float:none;margin:0 auto;border-right:0;\">' +\r\n\t\t'<div class=\"date\">' + timeStr + '</div>' +\r\n\t\t'<div class=\"clearfix address\">' +\r\n\t\t'<p class=\"fl start\">' + flt.startAirportNameCn + '</p>' +\r\n\t\t'<p class=\"fl icon\"></p>' +\r\n\t\t'<p class=\"fl dest\">' + flt.destAirportNameCn + '</p>' +\r\n\t\t'</div>' +\r\n\t\t'</div>' +\r\n\t\t// '<div class=\"right fl\">'+\r\n\t\t// \t'<img src=\"images/rain.png\" alt=\"\">'+\r\n\t\t// \t'<p>特大暴雨</p>'+\r\n\t\t// '</div>'+\r\n\t\t'</div>' +\r\n\t\t'<div class=\"cont\">' +\r\n\t\t'<div class=\"title clearfix\">' +\r\n\t\t'<p class=\"fl icon\"></p>' +\r\n\t\t'<p class=\"fl\">' + flt.iataCn + icon + flt.fltNo + '</p>' +\r\n\t\t'</div>' +\r\n\t\t'<div class=\"time\">' +\r\n\t\t'<ul>' +\r\n\t\t'<li>' +\r\n\t\t'<p>' + timeStart.name + '</p>' +\r\n\t\t'<p>' + timeStart.value + '</p>' +\r\n\t\t'<p>计划：' + flt.sdtTime + '</p>' +\r\n\t\t'</li>' +\r\n\t\t'<li>' +\r\n\t\t'<p>' + timeEnd.name + '</p>' +\r\n\t\t'<p>' + timeEnd.value + '</p>' +\r\n\t\t'<p>计划：' + flt.destSdtTime + '</p>' +\r\n\t\t'</li>' +\r\n\t\t'</ul>' +\r\n\t\t'<p class=\"status\">' + status + '</p>' +\r\n\t\t'</div>' +\r\n\t\t'<div class=\"tip\">' +\r\n\t\t'<ul>' +\r\n\t\t'<li>' +\r\n\t\t'<p class=\"value\">' + arr[0].value + '</p>' +\r\n\t\t'<p class=\"name\">' + arr[0].name + '</p>' +\r\n\t\t'</li>' +\r\n\t\t'<li>' +\r\n\t\t'<p class=\"value\">' + arr[1].value + '</p>' +\r\n\t\t'<p class=\"name\">' + arr[1].name + '</p>' +\r\n\t\t'</li>' +\r\n\t\t// '<li>'+\r\n\t\t// \t'<p class=\"value\">'+arr[2].value+'</p>'+\r\n\t\t// \t'<p class=\"name\">'+arr[2].name+'</p>'+\r\n\t\t// '</li>'+\r\n\t\t'</ul>' +\r\n\t\t'</div>' +\r\n\t\t'</div>' +\r\n\t\t'<div class=\"bottom\">' +\r\n\t\t'<ul class=\"clearfix\">' +\r\n\t\t'<li class=\"guanzhu\">' + follow + '</li>' +\r\n\t\t// '<li class=\"fl guide\">登机引导</li>'+\r\n\t\t// '<li class=\"fl\">退改签</li>'+\r\n\t\t// '<li class=\"fl\">在线值机</li>'+\r\n\t\t'</ul>' +\r\n\t\t'</div>'\r\n\t);\r\n\tvar color = getStateColor(status);\r\n\tobj.find('.status').css({\r\n\t\tcolor: color\r\n\t});\r\n\tobj.find('.title .icon').css({\r\n\t\tbackground: 'url(images/' + icon + '.gif)',\r\n\t\tbackgroundSize: 'contain'\r\n\t})\r\n\tobj.appendTo($('.g-wrap'));\r\n\r\n\t//登机导引请求的数据\r\n\tvar flyno = flt.iata + flt.fltNo;\r\n\tvar cntTerminalNo = flt.cntTerminalNo;\r\n\tif (typeof(cntTerminalNo) == \"undefined\" ) { \r\n\t\tcntTerminalNo = \"T2\";\r\n\t}\r\n\tvar djdata = {\r\n\t\tfltNo: flyno,\r\n\t\tcntTerminalNo: cntTerminalNo,\r\n\t};\r\n\t\r\n\tvar djjson = {\r\n\t\turl: 'http://airtest.rtmap.com/service-api/flight/getBoardingLead?token=' + token,\r\n\t\tdata: djdata,\r\n\t\tsuccess: function (data) {\r\n\t\t\tlocalStorage.removeItem(\"locations\");\r\n\t\t\tlocalStorage.locations = JSON.stringify(data);\r\n\t\t\tvar newstr = '';\r\n\t\t\tif (data != undefined) { \r\n\t\t\t\tfor (var i = 0; i < data.length; i++) {\r\n\t\t\t\t\tnewstr += JSON.stringify(data[i]) + '&';\r\n\t\t\t\t}\r\n\t\t\t\t//将打点的数据写到缓存\r\n\t\t\tlocalStorage.removeItem(\"locations\");\r\n\t\t\tlocalStorage.setItem(\"locations\",newstr);\r\n\t\t\tlocalStorage.point='';\r\n\t\t\t}\r\n\t\t\tdetail(data)\r\n\t\t}\r\n\t};\r\n\tajaxBase(djjson, false);\r\n\t\t\r\n\r\n\t//登机导引地图模块\r\n\t\r\n\tfunction detail(data) {\r\n\t\tvar details = data\r\n\t\tif (fltStrarr == \"D\" && (details != undefined)) {\r\n\t\t\t\tvar buildId = details[0].buildingId;\r\n\t\t\t\tif (details.length == 3) {\r\n\t\t\t\t\t$(\".guanzhu\").after(\"<li class='fl guide'>登机引导</li>\");  \r\n\t\t\t\t\tobj.find('.guanzhu').addClass('btnstyle');\r\n\t\t\t\t\tobj.find('.guide').addClass('btnstyle');\r\n\t\t\t\t\tobj.find('.guide').html('登机引导');\r\n\t\t\t\t\tobj.find('.guide').on('click', function () {\r\n\t\t\t\t\t    window.location.href = 'map/index.html?key=k7i23869hd&buildid=' + buildId + '&labelstyle=circle-point';\t\t\t\t\r\n\t\t\t\t\t});\r\n\t\t\t\t} else if (details.length == 1) {\r\n\t\t\t\t\tvar point = details.locations[0];\r\n\t\t\t\t\tlocalStorage.locations = '';\r\n\t\t\t\t\tlocalStorage.point=JSON.stringify(point);\r\n\t\t\t\t\tobj.find('.guide').html('登机口位置');\r\n\t\t\t\t\tobj.find('.guide').on('click', function() {\r\n\t\t\t\t\t\twindow.location.href = 'map/index.html?key=k7i23869hd&buildid=' + buildId + '&labelstyle=circle-point&floor=' +\r\n\t\t\t\t\t\t\tpoint.floor + '&center=[' + point.xCoord + ',' + point.yCoord + ']&zoom=19';\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tobj.find('.guide').hide();\r\n\t\t\t}\r\n\t\t}\r\n}"]}