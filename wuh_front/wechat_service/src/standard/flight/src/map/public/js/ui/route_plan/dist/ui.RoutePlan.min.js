
/* 起始点设置页 */(function(){window.searchTimeTmp={time:"",signal:{}};window.createSetStartPage=function(b){$(".set_point_page")&&$(".set_point_page").remove();var c=$("\x3cdiv class\x3d'set_point_page'/\x3e"),f=$("\x3cdiv class\x3d'title'\x3e\x3cspan class\x3d'fa fa-angle-left closeBtn'/\x3e\x3cdiv class\x3d'content' style\x3d'font-weight: bold;'\x3e\u8def\u7ebf\u89c4\u5212\x3c/div\x3e\x3cinput type\x3d'button' value\x3d'\u641c\u7d22'/\x3e\x3c/div\x3e"),a=$("\x3cdiv class\x3d'set_point'\x3e\x3cdiv class\x3d'left'\x3e\x3cimg src\x3d'./public/img/start_end_enter_title.png'width\x3d'24px' height\x3d'48px'/\x3e\x3c/div\x3e\x3cdiv class\x3d'middle'\x3e\x3cdiv\x3e\x3cinput class\x3d'set_start' type\x3d'text'/\x3e\x3c/div\x3e\x3cdiv\x3e\x3cinput  class\x3d'set_end' type\x3d'text'/\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'right'\x3e\x3cimg src\x3d'./public/img/start_end_change.png'width\x3d'35px' height\x3d'70px'/\x3e\x3c/div\x3e\x3c/div\x3e");if(b&&b.hasOwnProperty("type"))switch(b.type){case "start":a.find(".set_start").val(b.poi_name+" --- "+b.floor.toUpperCase());a.find(".set_start").attr({floor:b.floor.toUpperCase(),poi_no:b.poi_no,x:b.x,y:b.y});break;case "end":if(a.find(".set_end").val(b.poi_name+" --- "+b.floor.toUpperCase()),a.find(".set_end").attr({floor:b.floor.toUpperCase(),poi_no:b.poi_no,x:b.x,y:b.y}),b=Page.wechat.getLocaler())a.find(".set_start").val("\u6211\u7684\u4f4d\u7f6e"),a.find(".set_start").attr({floor:b.floor.toUpperCase(),poi_no:"",x:b.x,y:b.y})}a.find(".set-start").val();$(a.find("input")[0]).css({"border-bottom":"solid 1px #CEC4C4","padding-bottom":"9px"});$(a.find("input")[1]).css({"padding-top":"9px"});var g=$("\x3cdiv class\x3d'search_results'\x3e\x3cul class\x3d'poi_content'\x3e\x3c/ul\x3e\x3c/div\x3e");f.find("span").click(function(){accessLogAppender("opt_navi_setting_close",Page.URL.getParameter("key"));window.removeSetStartPage();$(".rtmap_search_box").show();$(".floor_change_box").show();Rtmap.TrackFactory.clearPath();Rtmap.TrackFactory.clearAll()});f.find("input").click(function(){if(a.find(".set_start").val()&&a.find(".set_end").val()){if(a.find(".set_start").val()&&a.find(".set_end").val()){$(".route_detail").remove();accessLogAppender("navi_req",Page.URL.getParameter("key"));var b=a.find(".set_start").attr("x"),h=a.find(".set_start").attr("y"),k=a.find(".set_start").attr("floor"),d=a.find(".set_end").attr("x"),e=a.find(".set_end").attr("y"),l=a.find(".set_end").attr("floor");if(b&&h&&k)if(d&&e&&l)try{window.Page.loading.show(),Rtmap.TrackFactory.setStartPoiXY(k,b,h),Rtmap.TrackFactory.setEndPoiXY(l,d,e,__onTrack)}catch(m){}else alert("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u7ec8\u70b9\u4fe1\u606f");else alert("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u8d77\u70b9\u4fe1\u606f")}}else a.find(".set_start").val()?alert("\u7ec8\u70b9\u4e0d\u80fd\u4e3a\u7a7a"):alert("\u8d77\u70b9\u4e0d\u80fd\u4e3a\u7a7a")});a.find(".right").click(function(){var b=a.find(".set_start").val(),h=a.find(".set_start").attr("poi_no"),k=a.find(".set_start").attr("floor"),d=a.find(".set_start").attr("x"),e=a.find(".set_start").attr("y"),l=a.find(".set_end").val(),m=a.find(".set_end").attr("poi_no"),c=a.find(".set_end").attr("floor"),f=a.find(".set_end").attr("x"),g=a.find(".set_end").attr("y");a.find(".set_start").val(l);a.find(".set_end").val(b);a.find(".set_start").attr("poi_no",m);a.find(".set_end").attr("poi_no",h);a.find(".set_start").attr("floor",c);a.find(".set_end").attr("floor",k);a.find(".set_start").attr("x",f);a.find(".set_end").attr("x",d);a.find(".set_start").attr("y",g);a.find(".set_end").attr("y",e)});a.find("input").keyup(function(a){$(this).attr({x:"",y:"",floor:""});var b=$(this).attr("class");if(13!=a.keyCode)if($(this).val()&&0!=$(this).val().indexOf(" ")){window.searchTimeTmp.time&&1E3>(new Date).getTime()-window.searchTimeTmp.time&&clearTimeout(window.searchTimeTmp.signal);window.searchTimeTmp.time=(new Date).getTime();var c=Page.URL.getParameter("key"),d=Page.URL.getParameter("buildid"),e=$(this).val();$(".set_point_page .poi_content").html("").css({height:"0"});window.searchTimeTmp.signal=setTimeout(function(){$.post("http://lbsapi.rtmap.com/rtmap_lbs_api/v1/rtmap/associationsearch",JSON.stringify({key:c,keywords:e,buildid:d}),function(a){accessLogAppender("navi_search",Page.URL.getParameter("key"));"0"==a.result.error_code&&a.hasOwnProperty("poilist")?"1"!=a.poilist.length?($(a.poilist).each(function(){var a=$("\x3cli/\x3e");a.css({"text-align":"left","font-size":"15px","border-bottom":"1px solid #cec4c4",padding:"8px"});a.append("\x3cspan class\x3d'poi_name' poi_no\x3d'"+this.poi_no+"' style\x3d'color:#B9B9B9'\x3e"+this.name+"\x3c/span\x3e\x26nbsp;\x3cspan class\x3d'poi_floor' x\x3d'"+this.x+"' y\x3d'"+this.y+"' style\x3d'color:#B9B9B9'\x3e"+this.floor+"\x3c/span\x3e");$(".set_point_page .poi_content").append(a);a.click(function(){$(".set_point_page ."+b+"").val($(this).find(".poi_name").text()+" --- "+$(this).find(".poi_floor").text());$(".set_point_page ."+b+"").attr({poi_no:$(this).find(".poi_name").attr("poi_no"),floor:$(this).find(".poi_floor").text(),x:$(this).find(".poi_floor").attr("x"),y:$(this).find(".poi_floor").attr("y")});$(".set_point_page .poi_content").html("").css({height:"0"})})}),$(".set_point_page .poi_content").animate({height:"100%"},1E3)):($(".set_point_page ."+b+"").val(a.poilist[0].name+"---"+a.poilist[0].floor),$(".set_point_page ."+b+"").attr({poi_no:a.poilist[0].poi_no,floor:a.poilist[0].floor,x:a.poilist[0].x,y:a.poilist[0].y})):(a='\x3cli style\x3d"text-align: left; font-size: 15px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(206, 196, 196); padding: 8px; background-color: white "\x3e\x3cspan\x3e\u672a\u80fd\u627e\u5230\u76f8\u5e94\u7ed3\u679c\x3c/span\x3e\x3c/li\x3e',g.find("ul").append(a),$(".set_point_page ."+b+"").val(""))})},500)}else g.find(".poi_content").html("")});$("body").append(c);c.animate({width:"100%"},300,function(){$(c).append(f);$(c).append(a);$(c).append(g)})};window.__onTrack=function(b){window.Page.loading.hide();if(b.hasOwnProperty("statusText")||"0"!=b.result.error_code)return accessLogAppender("navi_fail",Page.URL.getParameter("key")),alert("\u8def\u5f84\u89c4\u5212\u5931\u8d25"),!1;accessLogAppender("navi_success",Page.URL.getParameter("key"));window.__onTrackSuccess(b)};window.removeSetStartPage=function(){var b=$(".set_point_page");b.animate({width:"0"},300,function(){b.hide()})}})();