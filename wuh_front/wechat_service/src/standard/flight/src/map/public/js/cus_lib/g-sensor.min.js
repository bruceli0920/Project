//基于G-Sensor的计步算法
(function(){var c=[],g=[],p=0,h=!1,q=0,z=0,r=!1,l=0,m=0,t=0,u=0,k=0,A=0,n=0,v=2,f=0,w=0,x=0;window.addEventListener("devicemotion",function(b){c.splice(0,c.length);b=b.accelerationIncludingGravity;c.push(b.x);c.push(b.y);c.push(b.z);b=A=Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]);if(0==n)n=b;else{var d;d=n;r=h;b>=d?(h=!0,q++):(z=q,q=0,h=!1);!h&&r&&(2<=z||20<=d)?(l=d,d=!0):(!r&&h&&(m=d),d=!1);if(d&&(u=t,k=(new Date).getTime(),250<=k-u&&l-m>=v&&(t=k,f++,x=f-w),250<=k-u&&1.3<=l-m)){t=k;d=l-m;var a=v;if(4>p)g[p]=d,p++;else{for(var e=a=0;4>e;e++)a+=g[e];a/=4;a=8<=a?4.3:7<=a&&8>a?3.3:4<=a&&7>a?2.3:3<=a&&4>a?2:1.3;for(e=1;4>e;e++)g[e-1]=g[e];g[3]=d}v=a}}n=b;(b=document.getElementById("step"))?b.innerHTML=gSensor.getStep():"";y?y(f):""},!1);var y=null;window.gSensor={setCallback:function(b){y=b},getDiffStep:function(){x=f-w;w=f;return x},getStep:function(){return f}}})();