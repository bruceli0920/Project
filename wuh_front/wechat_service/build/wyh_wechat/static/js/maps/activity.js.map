{"version":3,"sources":["activity.js"],"names":["getDescQueryString","str","name","reg","RegExp","r","match","unescape","Mathrandom","min","max","randomNum","Math","floor","random","saveAddCardRecord","res","window","isBusy","ajaxBase","url","data","cardList","advertising","rate","getUrlQueryString","adcount","sing_iframe","undefined","$","attr","remove","css","display","parent","document","siblings","logdata_num","append","showTicket","type","_st","setTimeout","desc","indexOf","location","href","clearTimeout","cardId","cardCode","qr","flag","sourceid","wxaddCard","code","ready","logdata","giftType","_giftType","promoStatus","giftDetail","promoLog","box","_param","_openId","split","_promoId","_type","airportCode","_url","String","promoId","promoType","openId","wxInit","apiList","shakeEvent","Shake","threshold","start","addEventListener","JSONP","success","e","Boolean","Number","error","global","factory","define","amd","module","exports","this","options","hasDeviceMotion","timeout","i","hasOwnProperty","lastTime","Date","lastX","lastY","lastZ","CustomEvent","event","bubbles","cancelable","createEvent","initEvent","prototype","reset","stop","removeEventListener","devicemotion","deltaX","deltaY","deltaZ","current","accelerationIncludingGravity","x","y","z","abs","getTime","dispatchEvent","handleEvent"],"mappings":"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","file":"../activity.js","sourcesContent":["//调用自定义的shake摇一摇函数\r\n(function (global, factory) {\r\n\tif (typeof define === \"function\" && define.amd) {\r\n\t\tdefine(function () {\r\n\t\t\treturn factory(global, global.document)\r\n\t\t})\r\n\t} else {\r\n\t\tif (typeof module !== \"undefined\" && module.exports) {\r\n\t\t\tmodule.exports = factory(global, global.document)\r\n\t\t} else {\r\n\t\t\tglobal.Shake = factory(global, global.document)\r\n\t\t}\r\n\t}\r\n}(typeof window !== \"undefined\" ? window : this, function (window, document) {\r\n\tfunction Shake(options) {\r\n\t\tthis.hasDeviceMotion = \"ondevicemotion\" in window;\r\n\t\tthis.options = {\r\n\t\t\tthreshold: 15,\r\n\t\t\ttimeout: 1000\r\n\t\t};\r\n\t\tif (typeof options === \"object\") {\r\n\t\t\tfor (var i in options) {\r\n\t\t\t\tif (options.hasOwnProperty(i)) {\r\n\t\t\t\t\tthis.options[i] = options[i]\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.lastTime = new Date();\r\n\t\tthis.lastX = null;\r\n\t\tthis.lastY = null;\r\n\t\tthis.lastZ = null;\r\n\t\tif (typeof document.CustomEvent === \"function\") {\r\n\t\t\tthis.event = new document.CustomEvent(\"shake\", {\r\n\t\t\t\tbubbles: true,\r\n\t\t\t\tcancelable: true\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\tif (typeof document.createEvent === \"function\") {\r\n\t\t\t\tthis.event = document.createEvent(\"Event\");\r\n\t\t\t\tthis.event.initEvent(\"shake\", true, true)\r\n\t\t\t} else {\r\n\t\t\t\treturn false\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tShake.prototype.reset = function () {\r\n\t\tthis.lastTime = new Date();\r\n\t\tthis.lastX = null;\r\n\t\tthis.lastY = null;\r\n\t\tthis.lastZ = null\r\n\t};\r\n\tShake.prototype.start = function () {\r\n\t\tthis.reset();\r\n\t\tif (this.hasDeviceMotion) {\r\n\t\t\twindow.addEventListener(\"devicemotion\", this, false)\r\n\t\t}\r\n\t};\r\n\tShake.prototype.stop = function () {\r\n\t\tif (this.hasDeviceMotion) {\r\n\t\t\twindow.removeEventListener(\"devicemotion\", this, false)\r\n\t\t}\r\n\t\tthis.reset()\r\n\t};\r\n\tShake.prototype.devicemotion = function (e) {\r\n\t\tvar current = e.accelerationIncludingGravity;\r\n\t\tvar currentTime;\r\n\t\tvar timeDifference;\r\n\t\tvar deltaX = 0;\r\n\t\tvar deltaY = 0;\r\n\t\tvar deltaZ = 0;\r\n\t\tif ((this.lastX === null) && (this.lastY === null) && (this.lastZ === null)) {\r\n\t\t\tthis.lastX = current.x;\r\n\t\t\tthis.lastY = current.y;\r\n\t\t\tthis.lastZ = current.z;\r\n\t\t\treturn\r\n\t\t}\r\n\t\tdeltaX = Math.abs(this.lastX - current.x);\r\n\t\tdeltaY = Math.abs(this.lastY - current.y);\r\n\t\tdeltaZ = Math.abs(this.lastZ - current.z);\r\n\t\tif (((deltaX > this.options.threshold) && (deltaY > this.options.threshold)) || ((deltaX > this.options.threshold) && (deltaZ > this.options.threshold)) || ((deltaY > this.options.threshold) && (deltaZ > this.options.threshold))) {\r\n\t\t\tcurrentTime = new Date();\r\n\t\t\ttimeDifference = currentTime.getTime() - this.lastTime.getTime();\r\n\t\t\tif (timeDifference > this.options.timeout) {\r\n\t\t\t\twindow.dispatchEvent(this.event);\r\n\t\t\t\tthis.lastTime = new Date()\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.lastX = current.x;\r\n\t\tthis.lastY = current.y;\r\n\t\tthis.lastZ = current.z\r\n\t};\r\n\tShake.prototype.handleEvent = function (e) {\r\n\t\tif (typeof (this[e.type]) === \"function\") {\r\n\t\t\treturn this[e.type](e)\r\n\t\t}\r\n\t};\r\n\treturn Shake\r\n}));\r\n\r\n//获取desc里的字段\r\nfunction getDescQueryString(str, name) {\r\n\tvar reg = new RegExp(\"(^||)\" + name + \":([^|]*)(||$)\");\r\n\tvar r = str.match(reg);\r\n\tif (r != null) return unescape(r[2]);\r\n\treturn null;\r\n}\r\n// 随机函数 0,5 返回 0-5;\r\nfunction Mathrandom(min, max) {\r\n\tvar randomNum = max - min + 1;\r\n\treturn Math.floor(Math.random() * randomNum + min);\r\n};\r\n// 保存卡券投放记录\r\nfunction saveAddCardRecord(res) {\r\n\twindow.isBusy = false;\r\n\tajaxBase({\r\n\t\turl: \"/aup/api/wechat/card/addCard\",\r\n\t\tdata: cardList\r\n\t});\r\n}\r\n// 未中奖红包 广告页面 || 二维码页面\r\nfunction advertising() {\r\n\tvar rate = typeof getUrlQueryString(\"rate\") === \"string\" ? getUrlQueryString(\"rate\") : \"0\";\r\n\tvar adcount = getUrlQueryString(\"adcount\") || 1;\r\n\tvar random = Mathrandom(1, 10) / 10;\r\n\tvar sing_iframe = \"\";\r\n\tif ($('#sing_iframe').attr('src') != undefined) {\r\n\t\t$('#sing_iframe').remove();\r\n\t};\r\n\t$(\"#sing\").css({\r\n\t\t\"display\": \"none\"\r\n\t});\r\n\tif (random >= rate) {\r\n\t\tif($('#iframe', parent.document).siblings('#sing').css('display')){\r\n\t\t\t$('#iframe', parent.document).siblings('#sing').css({\r\n\t\t\t\t'display': 'none'\r\n\t\t\t});\r\n\t\t};\r\n\t\tlogdata_num = Mathrandom(1, adcount);\r\n\t\tvar theme = \"advertising/sing_\" + logdata_num + \".html\";\r\n\t\tsing_iframe = '<iframe id=\"sing_iframe\" src=\"' + theme + '\"></iframe>';\r\n\t\t$(\"#sing\").append(sing_iframe);\r\n\t\t$(\"#sing\").css({\r\n\t\t\t\"display\": \"block\"\r\n\t\t});\r\n\t} else {\r\n\t\t// var theme = \"lose.html\"\r\n\t\t// sing_iframe = '<iframe id=\"sing_iframe\" src=\"' + theme + '\"></iframe>';\r\n\t\t// $(\"#sing\").append(sing_iframe);\r\n\t\t$('#iframe', parent.document).siblings('#sing').css({\r\n\t\t\t'display': 'block'\r\n\t\t});\r\n\t};\r\n}\r\n\r\n// type:true 中奖（微信卡券、虚拟卡券）；false 不中奖（广告券、二维码关注公众号）\r\n// data：营销平台定义的卡券信息\r\nfunction showTicket(type, data) {\r\n\tlogdata_num = -1;\r\n\t_st = setTimeout(function () {\r\n\t\twindow.isBusy = type;\r\n\t}, 100);\r\n\tif (!type) {\r\n\t\tadvertising();\r\n\t\t//  录取logdata 数据\r\n\t\tlogdata.promoStatus = 40;\r\n\t\tlogdata.giftType = 4;\r\n\t\tlogdata.giftDetail = logdata_num || '';\r\n\t} else {\r\n\t\tif (data) {\r\n\t\t\tif (data.desc) {\r\n\t\t\t\tif (data.desc.indexOf(\"http\") >= 0 && data.desc.indexOf(\"http\") < 10) {\r\n\t\t\t\t\twindow.location.href = data.desc;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t//调用微信卡包\r\n\t\t\t\t\tclearTimeout(_st);\r\n\t\t\t\t\twindow.isBusy = false;\r\n\t\t\t\t\t// card数据\r\n\t\t\t\t\tcardList.cardId = getDescQueryString(data.desc, 'cardid');\r\n\t\t\t\t\tcardList.cardCode = data.qr; // 自定义卡券非预导入模式时，配置在营销平台上\r\n\t\t\t\t\tcardList.flag = getDescQueryString(data.desc, 'flag'); // Y:自定义编号卡券 N:非自定义编号卡券\r\n\t\t\t\t\tcardList.sourceid = getDescQueryString(data.desc, 'sourceid'); // 卡券来源：1:CIP 2:商贸、\r\n\t\t\t\t\tif (cardList.flag == 'Y') {\r\n\t\t\t\t\t\twxaddCard({\r\n\t\t\t\t\t\t\tcardId: cardList.cardId,\r\n\t\t\t\t\t\t\tcode: cardList.cardCode,\r\n\t\t\t\t\t\t\tready: saveAddCardRecord\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\twxaddCard({\r\n\t\t\t\t\t\t\tcardId: cardList.cardId,\r\n\t\t\t\t\t\t\tcode: '',\r\n\t\t\t\t\t\t\tready: saveAddCardRecord\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t};\r\n\t\t\t\t\t//  录取logdata 数据\r\n\t\t\t\t\tlogdata.giftType = _giftType; //奖品类型\r\n\t\t\t\t\tlogdata.promoStatus = 30; //单次参与活动的状态\r\n\t\t\t\t\tlogdata.cardId = cardList.cardId;\r\n\t\t\t\t\tlogdata.cardCode = cardList.cardCode;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\twindow.parent.promoLog(logdata);\r\n}\r\n// 加载之后立即执行\r\nfunction box() {\r\n\t// 传入参数  userId  promoId  code  giftType\r\n\t// 微信卡券 \r\n\tvar _param = getUrlQueryString(\"op\"),\r\n\t\t_openId = _param ? _param.split(\",\")[0] : (getUrlQueryString(\"userid\") || getUrlQueryString(\"userId\") || getUrlQueryString(\"o\")),\r\n\t\tpromoId = _param ? _param.split(\",\")[1] : (getUrlQueryString(\"promoid\") || getUrlQueryString(\"promoId\") || getUrlQueryString(\"p\")),\r\n\t\t_promoId = promoId || 15232,\r\n\t\t_type = getUrlQueryString(\"type\"),\r\n\t\t_type = _type ? ((_type != \"luck\") ? \"coupon\" : \"luck\") : \"luck\",\r\n\t\tairportCode = getUrlQueryString('code') || getUrlQueryString('airportCode') || \"PEK\",\r\n\t\t_url = String((_type == \"luck\") ? \"http://182.92.31.114/\" : \"http://101.201.176.54/\") + \"rest/act/\" + _promoId + \"/\" + String(_openId) + \"?\" + window.location.href.split(\"?\")[1];\r\n\r\n\t_giftType = getUrlQueryString(\"giftType\") || 4, //奖品类型\r\n\t\tlogdata = { //  录取logdata 数据\r\n\t\t\t\"promoId\": _promoId,\r\n\t\t\t// \"promoName\": \"shopping\",\r\n\t\t\t\"promoType\": 1,\r\n\t\t\t\"promoStatus\": 0,\r\n\t\t\t\"giftType\": _giftType,\r\n\t\t\t\"cardId\": '',\r\n\t\t\t\"cardCode\": '',\r\n\t\t\t\"giftDetail\": ''\r\n\t\t},\r\n\t\t// 卡卷保存数据 \r\n\t\tcardList = {\r\n\t\t\topenId: _openId,\r\n\t\t\tcardId: \"\",\r\n\t\t\tcardCode: \"\",\r\n\t\t\tflag: \"\",\r\n\t\t\tsourceid: \"\",\r\n\t\t\tairportCode: airportCode\r\n\t\t};\r\n\twxInit({\r\n\t\tapiList: 'addCard'\r\n\t});\r\n\t//没中红包的函数\r\n\tfunction shakePrize() {\r\n\t\tJSONP({\r\n\t\t\turl: _url,\r\n\t\t\tsuccess: function (e) {\r\n\t\t\t\tshowTicket(!Boolean(Number(e.code)), e);\r\n\t\t\t},\r\n\t\t\terror: function (e) {\r\n\t\t\t\tshowTicket(false);\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\tvar shakeEvent = new Shake({\r\n\t\tthreshold: 8\r\n\t});\r\n\twindow.isBusy = false;\r\n\tshakeEvent.start();\r\n\twindow.addEventListener('shake', function () {\r\n\t\t// alert('aaa' + isBusy);\r\n\t\tif (isBusy) return;\r\n\t\twindow.isBusy = true;\r\n\t\tshakePrize();\r\n\t}, false);\r\n}"]}