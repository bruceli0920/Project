{"version":3,"sources":["common.js"],"names":["setUserId","userId","sessionStorage","setItem","getUserId","getItem","setUserType","userType","getUserType","setAreaCode","areaCode","getAreaCode","setPageEntrance","entrance","getPageEntrance","updateCommonParam","commonParam","getUrlQueryString","pageEntrance","setSession","_setValue","key","value","window","currentAirport","localer","actionUrl","promoUrl","pageLoad","pageLocation","location","origin","protocol","hostname","port","buildingId","floorNo","xCoord","yCoord","rnd","n","m","Math","random","GetQueryString","str","name","decodeURIComponent","reg","RegExp","r","substr","indexOf","match","unescape","href","trim","replace","parseDom","div","document","createElement","innerHTML","childNodes","ajaxBase","obj","ignore","lert","loading","sign","url","data","noLoading","Loading","init","error","errorCode","Dialog","alert","_doFunction","func","args","Array","prototype","slice","call","arguments","apply","this","_hideLoading","hideOneLoading","hideLoading","hide","contentType","JSON","stringify","$","ajax","type","dataType","beforeSend","show","cache","async","done","json","textStatus","jqXHR","code","success","rst","msg","fail","errorThrown","always","complete","jumpTo","openid","backAction","selector","back","querySelector","getAttribute","flag","refresh","addEventListener","history","go","homeAction","home","top","urlPrefix","oauthPrefix","runLocationThead","callback","WechatLocate","prepare","debug","timer","setInterval","locationData","result","error_code","clearInterval","lbsinfo","buildid","floor","x","y","ajaxActionLog","time","Date","getTime","requestUrl","requestTime","action","ajaxObj","e","console","log","stopLocation","actionLog","local","ajaxPromoLog","docReady","_do","readyState","config","loadingHtml","text","_this","setMsg","innerText","body","appendChild","classList","remove","add","eventObj","cancel","confirm","shown","hidden","_getDom","_trigger","arr","i","l","length","_append","child","_bindEvent","elem","handler","types","split","off","btnClick","sureBtn","cancelBtn","event","preventDefault","stopPropagation","on","push","setValue","title"],"mappings":"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","file":"../common.js","sourcesContent":["window.currentAirport = 'CKG';\r\nwindow.localer = {};\r\nactionUrl = 'http://weixin.bcia.com.cn/aup/api/log/pageAction' || '/aup/api/log/pageAction';\r\npromoUrl = 'http://weixin.bcia.com.cn/aup/api/log/promoLog' || '/aup/api/log/promoLog';\r\n// 页面事件\r\nwindow.pageLoad = 'pageLoad';\r\nwindow.pageLocation = 'pageLocation';\r\n\r\n// js 兼容 ----------------------------------------\r\nif (!window.location.origin) {\r\n    window.location.origin = window.location.protocol + \"//\" + window.location.hostname + (window.location.port ? ':' + window.location.port : '');\r\n}\r\n// ------------------------------------------------\r\n\r\n/**\r\n *\r\n * 存储 userId 到session 中\r\n * @param {any} userId\r\n */\r\nfunction setUserId(userId) {\r\n\tsessionStorage.setItem('userId', userId);\r\n}\r\n/**\r\n *\r\n * 获取 userId 根据userType 不同而取值不同\r\n * @returns\r\n */\r\nfunction getUserId() {\r\n\tvar userId = sessionStorage.getItem('userId');\r\n\treturn (!!userId && userId == 'null') ? null : userId;\r\n}\r\n\r\n/**\r\n *\r\n * 存储 userType 到session 中\r\n * @param {any} userType\r\n */\r\nfunction setUserType(userType) {\r\n\tsessionStorage.setItem('userType', userType);\r\n}\r\n/**\r\n *\r\n * 获取 userType\r\n * @returns\r\n */\r\nfunction getUserType() {\r\n\tvar userType = sessionStorage.getItem('userType');\r\n\treturn (!!userType && userType == 'null') ? null : userType;\r\n}\r\n\r\n/**\r\n *\r\n * 存储 areaCode 到session 中\r\n * @param {any} areaCode\r\n */\r\nfunction setAreaCode(areaCode) {\r\n\tsessionStorage.setItem('areaCode', areaCode);\r\n}\r\n/**\r\n *\r\n * 获取areaCode\r\n * @returns\r\n */\r\nfunction getAreaCode() {\r\n\tvar areaCode = sessionStorage.getItem('areaCode');\r\n\treturn (!!areaCode && areaCode == 'null') ? null : areaCode;\r\n}\r\n\r\n/**\r\n *\r\n * 存储 entrance 到session 中\r\n * @param {any} entrance\r\n */\r\nfunction setPageEntrance(entrance) {\r\n\tsessionStorage.setItem('entrance', entrance);\r\n}\r\n/**\r\n *\r\n * 获取 entrance\r\n * @returns\r\n */\r\nfunction getPageEntrance() {\r\n\tvar entrance = sessionStorage.getItem('entrance');\r\n\treturn (!!entrance && entrance == 'null') ? null : entrance;\r\n}\r\n/**\r\n * 更新 commonParam的参数值\r\n */\r\nfunction updateCommonParam() {\r\n\tcommonParam.userId = getUserId() || getUrlQueryString('userId');\r\n\tcommonParam.userType = getUserType() || getUrlQueryString('userType') || 1;\r\n\tcommonParam.areaCode = getAreaCode() || getUrlQueryString('areaCode');\r\n\tcommonParam.pageEntrance = getPageEntrance() || getUrlQueryString('entrance') || 200;\r\n}\r\n/**\r\n * 用于入口页面调用的 公共参数的session设置\r\n */\r\nfunction setSession() {\r\n\tvar _setValue = function(key, value) {\r\n\t\tif (!!value) {\r\n\t\t\tsessionStorage.setItem(key, value);\r\n\t\t}\r\n\t}\r\n\t_setValue('userId', getUrlQueryString('userId') || getUrlQueryString('openId') || getUrlQueryString('openid'));\r\n\t_setValue('userType', getUrlQueryString('userType'));\r\n\t_setValue('areaCode', getUrlQueryString('areaCode'));\r\n\t_setValue('entrance', getUrlQueryString('entrance'));\r\n\r\n\tupdateCommonParam();\r\n}\r\n\r\n// ajax调用需要传递的公共参数\r\nvar commonParam = {\r\n\tcurrentAirport: currentAirport,\r\n\tuserId: getUserId() || getUrlQueryString('userId'),\r\n\tuserType: getUserType() || getUrlQueryString('userType') || 1,\r\n\tareaCode: getAreaCode() || getUrlQueryString('areaCode'),\r\n\tbuildingId: '',\r\n\tfloorNo: '',\r\n\txCoord: '',\r\n\tyCoord: '',\r\n\tpageEntrance: getPageEntrance() || getUrlQueryString('entrance') || 200\r\n}\r\n\r\n/**\r\n *\r\n *返回一个n-m的随机数\r\n * @param {any} n\r\n * @param {any} m\r\n * @returns\r\n */\r\nfunction rnd(n, m) {\r\n\treturn Math.random() * (m - n) + n;\r\n}\r\n/**\r\n *\r\n * 获取地址栏的?后面的参数\r\n * @param {any} str\r\n * @param {any} name\r\n * @returns\r\n */\r\nfunction GetQueryString(str, name) {\r\n\tstr = decodeURIComponent(str);\r\n\tvar reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\");\r\n\tvar r = str.substr(str.indexOf(\"?\") + 1).match(reg);\r\n\tif (r != null) return unescape(r[2]);\r\n\treturn null;\r\n}\r\n/**\r\n *\r\n *获取地址栏里的某一个参数\r\n * @param {any} name\r\n * @returns\r\n */\r\nfunction getUrlQueryString(name) {\r\n\treturn GetQueryString(window.location.href, name);\r\n}\r\n/**\r\n *\r\n *去除收尾空格的函数\r\n * @param {any} str\r\n * @returns\r\n */\r\nfunction trim(str) {\r\n\treturn str.replace(/^\\s+|\\s+$/g, '');\r\n}\r\n\r\n/**\r\n *\r\n * 转化 html 字符串 到 dom元素\r\n * @param {any} str\r\n * @returns\r\n */\r\nfunction parseDom(str) {\r\n\tvar div = document.createElement('div');\r\n\tdiv.innerHTML = str;\r\n\treturn div.childNodes[0];\r\n}\r\n/**\r\n *\r\n * 封装ajax\r\n * @param {any} obj\r\n * @param {any} ignore true 忽略公共参数的添加\r\n */\r\nfunction ajaxBase(obj, ignore) {\r\n\tvar lert = null; // dialog 弹出对象\r\n\tvar loading = null; // loading 弹层\r\n\tvar param = '';\r\n\tvar sign = obj.url;\r\n\r\n\t// loading初始化\r\n\tvar _initTool = function() {\r\n\t\t//  obj.noLading = true 时 不显示 loading弹层\r\n\t\tif (ajaxBase.data.loading && !obj.noLoading) { //全局显示 loading 或 单次调用不禁止loading显示时\r\n\t\t\tloading = Loading.init(); // 加载 loading代码\r\n\t\t\tajaxBase.loading = loading; //暴露 loading 给 ajaxBase\r\n\t\t}\r\n\t\tif (!obj.error || !obj.errorCode) { // 不自己处理错误时添加公共的弹出处理\r\n\t\t\tlert = Dialog.init('alert'); //加载 弹出层代码\r\n\t\t\tajaxBase.alert = lert; //暴露 alert 给 ajaxBase\r\n\t\t}\r\n\t}\r\n\tif (!ignore) {\r\n\t\t// var arr = [];\r\n\t\t// for (var key in commonParam) {\r\n\t\t// \tarr.push(key + '=' + commonParam[key]);\r\n\t\t// }\r\n\t\t// arr.push('requestTime=' + (+new Date()));\r\n\t\t// param = sign + param + arr.join('&');\r\n\r\n\t\t_initTool();\r\n\t} else { // 忽略公共参数\r\n\t\tparam = sign + 'ignoreLog=true'; //忽略参数 控制后台是否解析公共参数\r\n\t}\r\n\tvar _doFunction = function(func) { // 判断并执行方法\r\n\t\tvar args = Array.prototype.slice.call(arguments, 1); //截取 第一个参数 后面的参数\r\n\t\ttypeof func === 'function' && func.apply(this, args);\r\n\t}\r\n\tvar _showLoading = function() {\r\n\t\tif (loading) {\r\n\t\t\t// 默认 显示时 展示loading\r\n\t\t\tloading.show();\r\n\t\t}\r\n\t}\r\n\tvar _hideLoading = function() { //隐藏 loading动画\r\n\t\tif (loading) {\r\n\t\t\t// obj.hideLoading 不传 true 默认隐藏 ,传递值 true 隐藏 flase 不隐藏\r\n\t\t\tvar hideOneLoading = 'hideLoading' in obj ? (obj.hideLoading ? true : false) : true;\r\n\t\t\t// 默认显示 且 不自己处理 隐藏loading操作时 隐藏 loading, obj.hideLoading 控制单个 ajax调用的 隐藏loading 方式\r\n\t\t\t(ajaxBase.data.hideLoading || hideOneLoading) && loading.hide();\r\n\t\t}\r\n\t}\r\n\tvar contentType = obj.contentType == 'default' ? 'application/x-www-form-urlencoded' : obj.contentType;\r\n\tvar data = JSON.stringify(obj.data || {});\r\n\t// application/json 时 才会转化到 json字符串\r\n\tif (contentType && contentType.indexOf('application/json') < 0) {\r\n\t\tdata = obj.data || {};\r\n\t}\r\n\t$.ajax({\r\n\t\ttype: obj.type || 'post',\r\n\t\tdataType: obj.dataType || 'json',\r\n\t\tcontentType: contentType || 'application/json; charset=utf-8',\r\n\t\tbeforeSend: function() {\r\n\t\t\t_showLoading();\r\n\t\t\t_doFunction(obj.beforeSend);\r\n\t\t},\r\n\t\tcache: obj.cache == 'yes' ? true : false, //默认无缓存\r\n\t\tasync: obj.async == 'no' ? false : true, // 默认true异步\r\n\t\tdata: data,\r\n\t\turl: obj.url\r\n\t\t//  + param\r\n\t}).done(function(json, textStatus, jqXHR) {\r\n\t\tif (json.code == '0') { //请求成功\r\n\t\t\t_doFunction(obj.success, json.rst, json.code); // 传入code备用\r\n\t\t\t_hideLoading();\r\n\t\t} else if (json.code == '-1') { // 求情错误\r\n\t\t\tif (obj.errorCode) { // 自己处理 请求出错 如控制页面跳转\r\n\t\t\t\t_hideLoading();\r\n\t\t\t\t_doFunction(obj.errorCode, json);\r\n\t\t\t} else {\r\n\t\t\t\t_hideLoading();\r\n\t\t\t\tlert && lert.show('请求错误', json.msg);\r\n\t\t\t}\r\n\t\t}\r\n\t}).fail(function(jqXHR, textStatus, errorThrown) {\r\n\t\t_doFunction.fail = true; // 请求成功\r\n\t\tif (obj.error) { // 自己处理错误\r\n\t\t\t_doFunction(obj.error, errorThrown);\r\n\t\t} else {\r\n\t\t\tlert && lert.show('请求失败', '服务器异常');\r\n\t\t}\r\n\t}).always(function() {\r\n\t\t(_doFunction.fail && loading) && loading.hide();\r\n\t\t_doFunction(obj.complete);\r\n\t});\r\n}\r\najaxBase.data = {\r\n\tloading: true, // 全局设置是否显示 loading 信息 true 显示 false 不显示\r\n\thideLoading: true // 是否直接控制隐藏 true 自动控制隐藏 false 不自动隐藏自己控制\r\n}\r\najaxBase.config = function(obj) { // 修改全局\r\n\t\tfor (var key in obj) {\r\n\t\t\tif (key in ajaxBase.data) {\r\n\t\t\t\tajaxBase.data[key] = obj[key];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * ~位运算符 用来转换时间到数字\r\n\t * 窗口跳转到某个链接\r\n\t * @param {any} url\r\n\t * @param {any} type\r\n\t */\r\nfunction jumpTo(url, type) {\r\n\tif (!url) {\r\n\t\treturn;\r\n\t}\r\n\tvar v = getUrlQueryString('v');\r\n\tvar openid = getUrlQueryString('openid') || getUrlQueryString('openId');\r\n\t// if (type == 'add-version' && !v) { // 随机添加版本号 可以避免一些缓存\r\n\t// \turl = url.lastIndexOf('#') > -1 ? url.substring(0, url.length - 1) : url;\r\n\t// \tvar q = url.indexOf('?') > -1;\r\n\t// \turl = url + (q ? '&v=' : '?v=') + ~~new Date();\r\n\t// }\r\n\tif (!openid && !!commonParam.userId) { //没有openid 且 userId 有值 添加 openid\r\n\t\topenid = commonParam.userId;\r\n\t\tvar sign = url.indexOf('?') > -1 ? '&' : '?';\r\n\t\turl = url + sign + 'openid=' + openid;\r\n\t}\r\n\twindow.location.href = url;\r\n}\r\n/**\r\n *\r\n * 添加回退事件\r\n * @param {any} selector 回退按钮选择器\r\n * @returns\r\n */\r\nfunction backAction(selector) {\r\n\tvar back = document.querySelector(selector || '.back');\r\n\tif (!!back) {\r\n\t\tvar ignore = back.getAttribute('ignore');\r\n\t\tif (ignore) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar href = back.getAttribute('href');\r\n\t\tvar flag = href.indexOf('#') > -1 || href.indexOf('history') < 0 || trim(href) == '';\r\n\t\tvar refresh = back.getAttribute('refresh');\r\n\r\n\t\tif (!href || flag) { // 不为空 或 是无效链接\r\n\t\t\tback.addEventListener('click', function() {\r\n\t\t\t\t// if (document.referrer) { // 获取上一个页面的 url: 有时会丢失 导致两个页面循环跳转\r\n\t\t\t\t//     window.location.href = document.referrer;\r\n\t\t\t\t// }\r\n\t\t\t\tif (refresh) { // 返回并刷新\r\n\t\t\t\t\twindow.history.go(-1); // 返回 并刷新\r\n\t\t\t\t} else {\r\n\t\t\t\t\twindow.history.back(); // 返回\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n}\r\n/**\r\n *\r\n * 添加跳转到home页面事件\r\n * @param {any} selector 回退按钮选择器\r\n * @returns\r\n */\r\nfunction homeAction(selector) {\r\n\tvar home = document.querySelector(selector || '.home');\r\n\tif (!!home) {\r\n\t\tvar ignore = home.getAttribute('ignore');\r\n\t\tif (ignore) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar href = home.getAttribute('href');\r\n\t\tvar flag = href.indexOf('#') > -1 || href.indexOf('history') < 0 || trim(href) == '';\r\n\t\tvar refresh = home.getAttribute('refresh');\r\n\t\t//需要修改的地方\r\n\t\tif ( flag ) { // 不为无效链接\r\n\t\t\thome.addEventListener('click', function() {\r\n\t\t\t\tif( commonParam.userId ) { // sessionStorage 中有 userId ( openId )\r\n\t\t\t\t\twindow.top.location.href = '/standard/entrance/portal.html';\r\n\t\t\t\t} else { // 没有 userId (openId) 进行重定向 重新获取\r\n\t\t\t\t\tvar urlPrefix = window.location.origin;\r\n\t\t\t\t\tvar oauthPrefix = urlPrefix.indexOf('traffic') > -1 ? 'http://traffic.rtmap.com/aup/api/wechat/oauth/snsapiBase?redirect_uri='\r\n\t\t\t\t\t\t\t\t\t: 'http://airtest.rtmap.com/aup/api/wechat/oauth/snsapiBase?redirect_uri=';\r\n\r\n\t\t\t\t    window.top.location.href = oauthPrefix + urlPrefix + '/standard/entrance/portal.html';\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n}\r\n/**\r\n * 启动获取位置信息的定时器\r\n * js 依赖 rtmap.lbspoisdk.1.0.1.js 和 getlocation.js\r\n */\r\nfunction runLocationThead(callback) {\r\n\tWechatLocate.prepare({\r\n\t\tdebug: \"false\"\r\n\t});\r\n\tvar timer = setInterval(function() {\r\n\t\tvar data = WechatLocate.locationData();\r\n\r\n\t\tif (data && data.result.error_code == 0) {\r\n\t\t\tclearInterval(timer);\r\n\r\n\t\t\tcommonParam.buildingId = window.localer.buildingId = data.lbsinfo.buildid;\r\n\t\t\tcommonParam.floorNo = window.localer.floorNo = data.lbsinfo.floor;\r\n\t\t\tcommonParam.xCoord = window.localer.xCoord = data.lbsinfo.x;\r\n\t\t\tcommonParam.yCoord = window.localer.yCoord = data.lbsinfo.y;\r\n\r\n\r\n\t\t\ttypeof callback === 'function' && callback();\r\n\t\t}\r\n\t}, 1000);\r\n}\r\n/**\r\n *\r\n *记录页面动作日志，包括请求定位日志\r\n * @param {any} json\r\n * @param {any} callback\r\n */\r\nfunction ajaxActionLog(json, callback) {\r\n\tvar time = new Date().getTime();\r\n\tjson.data.currentAirport = currentAirport;\r\n\tjson.data.requestUrl = window.location.href;\r\n\tjson.data.requestTime = time;\r\n\r\n\tjson.data.userId = json.data.userId || commonParam.userId;\r\n\tjson.data.userType = json.data.userType || commonParam.userType;\r\n\tjson.data.areaCode = json.data.areaCode || commonParam.areaCode;\r\n\tjson.data.pageEntrance = json.data.pageEntrance || commonParam.pageEntrance;\r\n\tjson.data.action = json.data.action || pageLoad;\r\n\r\n\r\n\tvar ajaxObj = {\r\n\t\t\turl: actionUrl,\r\n\t\t\tdata: json.data,\r\n\t\t\ttype: json.type,\r\n\t\t\tcontentType: json.contentType || 'application/json; charset=utf-8',\r\n\t\t\tsuccess: json.success,\r\n\t\t\terror: function(e) {\r\n\t\t\t\tconsole.log('日志服务调用失败!');\r\n\t\t\t}\r\n\t\t}\r\n\t\t// 页面初始化 日志记录\r\n\tajaxBase(ajaxObj, true);\r\n\tif (json.stopLocation) { // 禁用定位轮询,定位已其它方式获取时使用\r\n\t\tajaxObj.data.action = pageLocation;\r\n\r\n\t\t//暴露 触发位置信息的日志记录 调用流程 ajaxActionLog() 后执行 并传入位置信息 ajaxActionLog.actionLog({});\r\n\t\t// 暴率方法 actionLog 此方法可以访问到 内部变量\r\n\t\tajaxActionLog.actionLog = function(local) {\r\n\t\t\tif (local) {\r\n\t\t\t\tajaxObj.data.buildingId = local.buildingId;\r\n\t\t\t\tajaxObj.data.floorNo = local.floorNo;\r\n\t\t\t\tajaxObj.data.xCoord = local.xCoord;\r\n\t\t\t\tajaxObj.data.yCoord = local.yCoord;\r\n\t\t\t\tajaxBase(ajaxObj, true);\r\n\t\t\t}\r\n\t\t}\r\n\t} else { // 默认调用获取位置定时器\r\n\t\trunLocationThead(function() {\r\n\t\t\t// 赋值位置信息\r\n\t\t\tjson.data.buildingId = localer.buildingId;\r\n\t\t\tjson.data.floorNo = localer.floorNo;\r\n\t\t\tjson.data.xCoord = localer.xCoord;\r\n\t\t\tjson.data.yCoord = localer.yCoord;\r\n\t\t\tjson.data.action = pageLocation;\r\n\r\n\t\t\tajaxObj.data = json.data;\r\n\t\t\tajaxBase(ajaxObj, true);\r\n\t\t\ttypeof callback === 'function' && callback();\r\n\t\t});\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n *\r\n * 活动日志\r\n * @param {any} json\r\n */\r\nfunction ajaxPromoLog(json) {\r\n\tjson.data.currentAirport = currentAirport;\r\n\tvar ajaxObj = {\r\n\t\turl: promoUrl,\r\n\t\tdata: json.data,\r\n\t\ttype: json.type,\r\n\t\tcontentType: json.contentType || 'application/json; charset=utf-8',\r\n\t\tsuccess: json.success,\r\n\t\terror: function(e) {\r\n\t\t\tconsole.log('活动日志服务调用失败!');\r\n\t\t}\r\n\t}\r\n\tajaxBase(ajaxObj, true);\r\n}\r\n\r\n/**\r\n * 文档加载完成\r\n * \r\n * @param {any} callback\r\n */\r\nfunction docReady(callback) {\r\n    //console.log(document.readyState);\r\n    var readyState = document.readyState;\r\n    var _do = function () {\r\n        // homeAction();\r\n        typeof callback === 'function' && callback();\r\n    }\r\n    if (readyState == 'complete') {\r\n        _do();\r\n    } else {\r\n        document.addEventListener('DOMContentLoaded', function () {\r\n            _do();\r\n        }, false);\r\n    }\r\n}\r\n\r\ndocReady(function() {\r\n\thomeAction();\r\n});\r\n\r\n// 合并 其它功能\r\n// \r\n// 数据加载动态 层 空出第一行便于合并\r\n// 合并到 common.js中 以来 common.js的方法 有: parseDom\r\nvar Loading = (function(){\r\n\tvar loadingHtml = \r\n\t\t\t\t\t'<div class=\"loading_toast hidden\">'+\r\n\t\t\t\t\t\t'<div class=\"mask_transparent\"></div>'+\r\n\t\t\t\t\t\t'<div class=\"toast\">'+\r\n\t\t\t\t\t\t\t'<div class=\"loading\">'+\r\n\t\t\t\t\t\t\t\t'<div class=\"loading_leaf loading_leaf_0\"></div>'+\r\n\t\t\t\t\t\t\t\t'<div class=\"loading_leaf loading_leaf_1\"></div>'+\r\n\t\t\t\t\t\t\t\t'<div class=\"loading_leaf loading_leaf_2\"></div>'+\r\n\t\t\t\t\t\t\t\t'<div class=\"loading_leaf loading_leaf_3\"></div>'+\r\n\t\t\t\t\t\t\t\t'<div class=\"loading_leaf loading_leaf_4\"></div>'+\r\n\t\t\t\t\t\t\t\t'<div class=\"loading_leaf loading_leaf_5\"></div>'+\r\n\t\t\t\t\t\t\t\t'<div class=\"loading_leaf loading_leaf_6\"></div>'+\r\n\t\t\t\t\t\t\t\t'<div class=\"loading_leaf loading_leaf_7\"></div>'+\r\n\t\t\t\t\t\t\t\t'<div class=\"loading_leaf loading_leaf_8\"></div>'+\r\n\t\t\t\t\t\t\t\t'<div class=\"loading_leaf loading_leaf_9\"></div>'+\r\n\t\t\t\t\t\t'<div class=\"loading_leaf loading_leaf_10\"></div>'+\r\n\t\t\t\t\t\t'<div class=\"loading_leaf loading_leaf_11\"></div>'+\r\n\t\t\t\t\t\t'</div>'+\r\n\t\t\t\t\t'<p class=\"toast_content\">数据加载中</p>'+\r\n\t\t\t\t\t'</div>'+\r\n\t\t\t\t\t'</div>';\r\n\tvar loading = null;\t\t\t\t\r\n\tvar text = '数据加载中';\r\n\tfunction Loading(){\r\n\t\tvar _this = this;\r\n\t\tthis.code = null;\r\n\r\n\t\tthis.setMsg = function( msg ){ //设置文字 \r\n\t\t\tmsg && ( text = msg );\r\n\t\t\tvar content = _this.code.querySelector('.toast_content');\r\n\t\t\tcontent.innerText = text;\r\n\t\t\treturn _this;\r\n\t\t}\r\n\t\tthis.init = function(){ // 代码加载到  body 中\r\n\t\t\t_this.code = parseDom( loadingHtml );\r\n\t\t\tdocument.body.appendChild( _this.code );\r\n\t\t}\r\n\t\tthis.show = function( msg ){ //显示\r\n\t\t\t_this.code.classList.remove('hidden');\r\n\t\t\t_this.setMsg(msg);\r\n\t\t\treturn _this;\r\n\t\t}\t\r\n\t\tthis.hide = function(){// 隐藏\r\n\t\t\t_this.code.classList.add('hidden');\r\n\t\t\treturn _this;\r\n\t\t}\r\n\t\treturn this.init();\r\n\t}\r\n\treturn {\r\n\t\tinit:function(){\r\n\t\t\treturn loading || (loading = new Loading());\r\n\t\t}\r\n\t}\t\t\t\t\t\r\n}());\r\n// \r\n// 公用弹出框 空出第一行便于合\r\n// 合并到 common.js中 以来 common.js的方法 有: parseDom\r\nvar Dialog = (function(){\r\n\t\r\n\tvar eventObj = { // 事件绑定类型定义\r\n\t\tcancel:[], confirm:[],\r\n\t\tshow:[], shown:[],\r\n\t\thide:[], hidden:[]\r\n\t}\r\n\t\r\n\t// 根据 type 获取对应代码的 dom\r\n\tvar _getDom = function( type ){\r\n\t\tvar className = type == 'alert'\t? 'dialog_alert':'dialog_confirm';\r\n\t\tvar html = \r\n\t\t'<div class=\"'+className+' hidden\">'+\r\n\t\t\t'<div class=\"mask\"></div>'+\r\n\t\t\t'<div class=\"dialog\">'+\r\n\t\t\t\t'<div class=\"dialog_hd\"><strong class=\"dialog_title\"></strong></div>'+\r\n\t\t\t\t'<div class=\"dialog_bd\"></div>'+\r\n\t\t\t\t'<div class=\"dialog_ft\">'+\r\n\t\t\t\t\t( type != 'alert' ? \r\n\t\t\t\t\t'<a href=\"javascript:;\" class=\"btn_dialog default\">取消</a>':'')+\r\n\t\t\t\t\t'<a href=\"javascript:;\" class=\"btn_dialog primary\">确定</a>'+\r\n\t\t\t\t'</div>'+\r\n\t\t\t'</div>'+\r\n\t\t'</div>';\r\n\t\treturn parseDom( html );\r\n\t}\r\n\t\r\n\t\r\n\tvar _trigger = function(name){ // 触发事件\r\n\t\tvar arr = eventObj[name];\r\n\t\tfor( var i=0,l=arr.length;i<l;i++ ){\r\n\t\t\tarr[i].apply(this,[]);\r\n\t\t}\r\n\t}\r\n\tvar _append = function( child ){\r\n\t\tdocument.body.appendChild( child );\r\n\t}\r\n\tvar _bindEvent = function(elem,type,handler){ // 事件绑定\r\n\t\tif(elem){\r\n\t\t\tvar types = type.split(',');//绑定多个事件类型 click,touchstart\r\n\t\t\tfor(var i=0,l=types.length;i<l;i++){\r\n\t\t\t\telem.addEventListener(types[i],handler,true);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tvar obj = { // dialog返回两种类型 alert 类型 和 confirm类型\r\n\t\talert:null, // 只有确定按钮\r\n\t\tconfirm:null // 有取消按钮 确定按钮\r\n\t}\r\n\tfunction Dialog(type){\r\n\t\tvar _this = this;\r\n\t\tthis.code = null;\r\n\t\tthis.btnClick = function(){ //取消 確定按鈕 点击事件\r\n\t\t\tvar sureBtn = _this.code.querySelector('.primary');\r\n\t\t\tvar cancelBtn = _this.code.querySelector('.default');\r\n\t\t\t_bindEvent(sureBtn,'click,touchstart',function(event){\r\n\t\t\t\t\t_trigger('confirm');\r\n\t\t\t\t\t_this.hide();\r\n\t\t\t\t\tevent && event.preventDefault();\r\n\t\t\t});\r\n\t\t\t_bindEvent(sureBtn,'touchmove,touchend',function(event){\r\n\t\t\t\tevent && event.stopPropagation();\r\n\t\t\t});\r\n\t\t\t_bindEvent(cancelBtn,'click,touchstart',function(event){\r\n\t\t\t\t\t_trigger('cancel');\r\n\t\t\t\t\t_this.hide();\r\n\t\t\t\t\tevent && event.preventDefault();\r\n\t\t\t});\r\n\t\t\t_bindEvent(cancelBtn,'touchmove,touchend',function(event){\r\n\t\t\t\tevent && event.stopPropagation();\r\n\t\t\t});\r\n\t\t}\r\n\t\tthis.init = function(type){ // 初始化方法\r\n\t\t\t_this.code = _getDom(type);\t\r\n\t\t\t_append( _this.code );\r\n\t\t\t_this.btnClick();\r\n\t\t}\r\n\t\tthis.on = function(name,handler){ // 事件绑定\r\n\t\t\tif( name in eventObj ){ // 绑定的事件必须是 eventObj中定义的\r\n\t\t\t\teventObj[name].push(handler);\r\n\t\t\t}\r\n\t\t\treturn _this;\r\n\t\t}\r\n\t\tthis.off = function(name){// 事件解除\r\n\t\t\tif(!name){ // 解除全部\r\n\t\t\t\teventObj = { // \r\n\t\t\t\t\tcancel:[], confirm:[],\r\n\t\t\t\t\tshow:[], shown:[],\r\n\t\t\t\t\thide:[], hidden:[]\r\n\t\t\t\t}\r\n\t\t\t\treturn _this;\r\n\t\t\t}\r\n\t\t\tif(name in eventObj ){ // 解除某个事件类型\r\n\t\t\t\teventObj[name] = [];\r\n\t\t\t}\r\n\t\t\treturn _this;\r\n\t\t}\r\n\t\tthis.setValue = function(title,text){ // 设置 标题和 提示内容\r\n\t\t\tvar dgtitle = this.code.querySelector('.dialog_title');\r\n\t\t\tdgtitle.innerText = title || '';\r\n\t\t\tvar dgtext = this.code.querySelector('.dialog_bd');\r\n\t\t\tdgtext.innerText = text || '';\r\n\t\t\treturn _this;\t\t\t\r\n\t\t}\r\n\t\tthis.show = function(title,text){ //显示dialog\r\n\t\t\t_trigger('show');\r\n\t\t\t(title || text) && _this.setValue(title,text);\r\n\t\t\t_this.code.classList.remove('hidden');\r\n\t\t\t_trigger('shown');\r\n\t\t\treturn _this;\r\n\t\t}\r\n\t\tthis.hide = function(){ // 隐藏 dialog\r\n\t\t\t_trigger('hide');\r\n\t\t\t_this.code.classList.add('hidden');\r\n\t\t\t_trigger('hidden');\r\n\t\t\treturn _this;\r\n\t\t}\r\n\t\treturn this.init( type );\r\n\t}\r\n\r\n\treturn {\r\n\t\tinit:function( type ){ // 初始化 添加dialog代碼到 body中\r\n\t\t\tif( !type in obj ){ // 符合返回 要求\r\n\t\t\t\tthrow \"只支持 alert 和 confirm类型\";\r\n\t\t\t}\r\n\t\t\tif( !obj[type] ){\r\n\t\t\t\tobj[type] = new Dialog(type);\r\n\t\t\t}else{\r\n\t\t\t\tobj[type].off(); // 重复使用时 将之前绑定的事件 删除掉\r\n\t\t\t}\r\n\t\t\treturn obj[type];\r\n\t\t}\r\n\t}\r\n}());"]}